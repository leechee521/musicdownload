<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Song Station | ÊûÅÁÆÄÈü≥‰πê‰∏ãËΩΩ</title>
    <link rel="shortcut icon" href="../static/favicon.ico" type="image/x-icon">
    <!-- UI Ê°ÜÊû∂È¢ÑËÆæ -->
    <link rel="stylesheet" href="../static/css/index.css">
    <!-- Â≠ó‰ΩìÈ¢ÑËÆæ -->
        <link href="../static/css/css2.css?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Ê°ÜÊû∂ËµÑÊ∫ê -->
    <script src="../static/js/vue.js"></script>
    <script src="../static/js/index.js"></script>
    <script src="../static/js/socket.io.js"></script>
    
    <!-- ÈáçÂÜôÂêéÁöÑÊ†∑ÂºèÂ±Ç -->
    <link rel="stylesheet" href="../static/css/style.css">
</head>

<body>
    <div id="app">
        <el-container>
            <!-- ËÉ∂ÂõäÂºèÂØºËà™Ê†è -->
            <el-header>
                <div class="header-inner">
                    <div class="brand-title">SONG STATION</div>
                    <div class="header-actions">
                        <el-button @click="toDownloadPage" icon="el-icon-download" circle size="small"
                            class="settings-trigger" title="ÊâπÈáè‰∏ãËΩΩ"></el-button>
                        <el-button @click="settingsVisible = true" icon="el-icon-set-up" circle size="small"
                            class="settings-trigger" title="Âπ≥Âè∞ÈÖçÁΩÆ"></el-button>
                    </div>
                </div>
            </el-header>

            <el-main>
                <!-- ÂûÇÁõ¥Ëã±ÈõÑÂå∫Âüü -->
                <div class="hero-section">
                    <h1 class="hero-title">Êé¢Á¥¢ Á∫ØÂáÄÈü≥Ë¥®</h1>
                    <p class="hero-subtitle">ÂèëÁé∞„ÄÅÈ¢ÑËßàÂπ∂‰∏ãËΩΩÂÖ®ÁΩëÊó†ÊçüÈü≥‰πêËµÑÊ∫ê</p>

                    <div class="search-bar-wrap" :class="{ 'fixed': searchBarFixed }">
                        <el-select v-model="selectedSource" placeholder="Âπ≥Âè∞" style="width: 120px;" size="medium">
                            <el-option v-for="item in sources" :key="item.value" :label="item.label"
                                :value="item.value"></el-option>
                        </el-select>
                        <el-input placeholder="ËæìÂÖ•Ê≠åÊõ≤Âêç„ÄÅÊ≠åÊâãÊàñ‰∏ìËæë..." v-model="searchQuery" @keyup.enter.native="handleSearch"
                            style="flex: 1"></el-input>
                        <el-button type="primary" icon="el-icon-search" @click="handleSearch"
                            size="medium">ÊêúÁ¥¢</el-button>
                    </div>
                </div>
                
                <!-- Âõ∫ÂÆöÊêúÁ¥¢Ê°ÜÂÆπÂô® -->
                <div v-if="searchBarFixed" class="fixed-search-bar-container">
                    <div class="search-bar-wrap">
                        <el-select v-model="selectedSource" placeholder="Âπ≥Âè∞" style="width: 120px;" size="medium">
                            <el-option v-for="item in sources" :key="item.value" :label="item.label"
                                :value="item.value"></el-option>
                        </el-select>
                        <el-input placeholder="ËæìÂÖ•Ê≠åÊõ≤Âêç„ÄÅÊ≠åÊâãÊàñ‰∏ìËæë..." v-model="searchQuery" @keyup.enter.native="handleSearch"
                            style="flex: 1"></el-input>
                        <el-button type="primary" icon="el-icon-search" @click="handleSearch"
                            size="medium">ÊêúÁ¥¢</el-button>
                    </div>
                </div>

                <div class="content-grid">
                    <!-- ÂèëÁé∞Ê¶úÂçï (È¶ñÈ°µÊòæÁ§∫) -->
                    <div v-if="contentFlat">
                        <div class="section-label" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>‰ªäÊó•Êé®ËçêÊ¶úÂçï</span>
                            <el-radio-group v-model="currentTopListSource" size="small" @change="get_top_list(currentTopListSource)">
                                <el-radio-button label="wyy">ÁΩëÊòì‰∫ë</el-radio-button>
                                <el-radio-button label="qq">QQÈü≥‰πê</el-radio-button>
                            </el-radio-group>
                        </div>
                        <el-row :gutter="24">
                            <el-col :span="6" :md="6" :sm="12" :xs="24" v-for="item in topList" :key="item.title"
                                style="margin-bottom: 24px">
                                <el-card class="music-card" :body-style="{ padding: '16px' }">
                                    <div slot="header"
                                        style="display: flex; justify-content: space-between; align-items: center">
                                        <b style="font-size: 14px">{{item.title}}</b>
                                        <el-button type="text" size="mini"
                                            @click="loadMoreSongs(item)">Êõ¥Â§ö</el-button>
                                    </div>
                                    <div style="max-height: 300px; overflow-y: auto;">
                                        <div v-for="song in item.songs" :key="song.id" class="song-row"
                                            style="cursor: pointer"
                                            @click="playMusic(song)">
                                            <el-row type="flex" align="middle">
                                                <el-image :src="song.cover_url"
                                                    style="width: 40px; height: 40px; border-radius: 8px; flex-shrink:0; cursor: pointer"
                                                    fit="cover"
                                                    @click.native.stop="playMusic(song)"></el-image>
                                                <div style="margin-left: 12px; flex:1; min-width:0" class="song-info">
                                                    <div class="name"
                                                        style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                        {{song.title}}</div>
                                                    <div class="meta" style="cursor: pointer"
                                                        @click.stop="searchQuery = song.artist; handleSearch()">
                                                        {{song.artist}}
                                                    </div>
                                                </div>
                                                <el-button type="text" icon="el-icon-download"
                                                    @click.stop="toDownload(song.source,song.id)"></el-button>
                                            </el-row>
                                        </div>
                                    </div>
                                </el-card>
                            </el-col>
                        </el-row>
                    </div>

                    <!-- ÊêúÁ¥¢ÁªìÊûúÊàñÊ¶úÂçïËØ¶ÊÉÖ (ÊêúÁ¥¢ÂêéÊòæÁ§∫) -->
                    <div v-show="!contentFlat">
                        <div class="section-label">{{ sectionTitle }}</div>
                        <!-- ÂìçÂ∫îÂºèÂ∏ÉÂ±ÄÔºöÊ°åÈù¢Á´Ø‰ΩøÁî®Ë°®Ê†ºÔºåÊâãÊú∫Á´Ø‰ΩøÁî®Âç°Áâá -->
                        
                        <!-- ÊâãÊú∫Á´ØÂç°ÁâáÂ∏ÉÂ±Ä -->
                        <div class="mobile-content">
                            <!-- Ê≠åÊõ≤Âç°ÁâáÂàóË°® -->
                            <div v-for="row in results" :key="row.id" class="mobile-song-card">
                                <!-- Âç°ÁâáÂ§¥ÈÉ®ÔºöÂ∞ÅÈù¢ÂíåÂü∫Êú¨‰ø°ÊÅØ -->
                                <div class="mobile-card-header">
                                    <el-image :src="row.cover_url"
                                        style="width: 60px; height: 60px; border-radius: 12px; flex-shrink: 0; cursor: pointer" fit="cover"
                                        @error="handleImageError"
                                        @click.native="playMusic(row)"></el-image>
                                    <div style="margin-left: 12px; flex: 1; min-width: 0">
                                        <div class="mobile-card-title">{{ row.title }}</div>
                                        <div class="mobile-card-artist">{{ row.artist }}</div>
                                        <div class="mobile-card-album">{{ row.album || 'ÂçïÊõ≤' }}</div>
                                    </div>
                                </div>
                                
                                <!-- Âç°ÁâáÂ∫ïÈÉ®ÔºöÊù•Ê∫êÂíå‰∏ãËΩΩÊåâÈíÆ -->
                                <div class="mobile-card-footer">
                                    <el-tag size="mini" effect="plain" class="mobile-card-source">
                                        {{ getSourceName(row.source) }}
                                    </el-tag>
                                    <div class="mobile-card-download">
                                        <el-dropdown trigger="click" size="small">
                                            <el-button type="primary" size="small">
                                                ‰∏ãËΩΩ<i class="el-icon-arrow-down el-icon--right"></i>
                                            </el-button>
                                            <el-dropdown-menu slot="dropdown">
                                                <el-dropdown-item v-for="item in row.metadata.size" :key="item.level"
                                                    @click.native="download(row.source,row.id, item.level)">
                                                    {{getLevel(item.level)}} ({{formatFileSize(item.size)}})
                                                </el-dropdown-item>
                                            </el-dropdown-menu>
                                        </el-dropdown>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Á©∫Áä∂ÊÄÅ -->
                            <div v-if="results.length === 0" class="mobile-empty">
                                <div class="mobile-empty-icon">üéµ</div>
                                <div class="mobile-empty-text">Êú™ÊâæÂà∞Áõ∏ÂÖ≥ÁªìÊûú</div>
                            </div>
                            
                            <!-- ÊâãÊú∫Á´ØÂàÜÈ°µÁªÑ‰ª∂ -->
                            <div v-if="results.length > 0" class="mobile-pagination">
                                <div class="mobile-pagination-info">
                                    ÂÖ± {{ total }} È¶ñÊ≠åÊõ≤
                                </div>
                                <div class="mobile-pagination-buttons">
                                    <el-button size="small" :disabled="currentPage === 1" @click="handlePageChange(currentPage - 1)">
                                        ‰∏ä‰∏ÄÈ°µ
                                    </el-button>
                                    <span class="mobile-pagination-current">
                                        {{ currentPage }} / {{ Math.ceil(total / pageSize) }}
                                    </span>
                                    <el-button size="small" :disabled="currentPage >= Math.ceil(total / pageSize)" @click="handlePageChange(currentPage + 1)">
                                        ‰∏ã‰∏ÄÈ°µ
                                    </el-button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ê°åÈù¢Á´ØË°®Ê†ºÂ∏ÉÂ±Ä -->
                        <div class="desktop-content">
                            <el-table :data="results" style="width: 100%" v-loading="loading" empty-text="Êú™ÊâæÂà∞Áõ∏ÂÖ≥ÁªìÊûú">
                                <el-table-column label="Â∞ÅÈù¢" width="80">
                                    <template #default="{ row }">
                                        <el-image :src="row.cover_url"
                                            style="width: 48px; height: 48px; border-radius: 10px; cursor: pointer" fit="cover"
                                            @error="handleImageError"
                                            @click.native="playMusic(row)"></el-image>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Ê≠åÊõ≤‰ø°ÊÅØ" min-width="180">
                                    <template #default="{ row }">
                                        <div class="name" style="font-weight:600">{{ row.title }}</div>
                                        <div style="font-size:12px; color:var(--text-secondary)">{{ row.artist }}</div>
                                        <div style="font-size:12px; color:var(--text-secondary)">{{ row.album || 'ÂçïÊõ≤' }}
                                        </div>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êó∂Èïø/Êù•Ê∫ê" width="120">
                                    <template #default="{ row }">
                                        <div>{{ formatDuration(row.duration) }}</div>
                                        <el-tag size="mini" effect="plain">{{ getSourceName(row.source) }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="Êìç‰Ωú" width="120" align="center">
                                    <template #default="{ row }">
                                        <el-dropdown trigger="click">
                                            <el-button type="primary" size="mini" plain round>‰∏ãËΩΩ</el-button>
                                            <el-dropdown-menu slot="dropdown">
                                                <el-dropdown-item v-for="item in row.metadata.size" :key="item.level"
                                                    @click.native="download(row.source,row.id, item.level)">
                                                    {{getLevel(item.level)}} ({{formatFileSize(item.size)}})
                                                </el-dropdown-item>
                                            </el-dropdown-menu>
                                        </el-dropdown>
                                    </template>
                                </el-table-column>
                            </el-table>
                            
                            <!-- Ê°åÈù¢Á´ØÂàÜÈ°µÁªÑ‰ª∂ -->
                            <div v-if="results.length > 0" style="margin-top: 24px; text-align: center;">
                                <el-pagination background layout="prev, pager, next, total" :total="total"
                                    :page-size="pageSize" :current-page.sync="currentPage"
                                    @current-change="handlePageChange">
                                </el-pagination>
                            </div>
                        </div>
                    </div>
                </div>
            </el-main>
        </el-container>

        <!-- ÂÖ®‰∏≠ÊñáËÆæÁΩÆÁ™ó (Ëá™ÂÆö‰πâ Title Slot) -->
        <el-dialog :visible.sync="settingsVisible" width="460px" custom-class="glass-dialog" :append-to-body="true"
            :show-close="false">
            <div class="custom-close-layer" @click="settingsVisible = false">
                <i class="el-icon-close"></i>
            </div>
            <div slot="title" class="custom-dialog-header">
                <span class="title-text">Âπ≥Âè∞ÈÖçÁΩÆ</span>
            </div>
            <el-form label-position="top">
                <el-form-item label="QQ Èü≥‰πê Cookie">
                    <el-input type="textarea" :rows="4" v-model="cookies.qqMusic"
                        placeholder="Á≤òË¥¥ QQ Èü≥‰πêÁΩëÁªúËØ∑Ê±Ç‰∏≠ÁöÑ Cookie"></el-input>
                </el-form-item>
                <el-form-item label="ÁΩëÊòì‰∫ëÈü≥‰πê Cookie">
                    <el-input type="textarea" :rows="4" v-model="cookies.wyyMusic"
                        placeholder="Á≤òË¥¥ÁΩëÊòì‰∫ëÈü≥‰πêÁΩëÁªúËØ∑Ê±Ç‰∏≠ÁöÑ Cookie"></el-input>
                </el-form-item>
            </el-form>
            <div slot="footer">
                <el-button @click="settingsVisible = false" size="medium">ÂÖ≥Èó≠</el-button>
                <el-button type="primary" @click="saveCookies" :loading="savingCookies" size="medium">‰øùÂ≠òÈÖçÁΩÆ</el-button>
            </div>
        </el-dialog>
       
        <!-- Èü≥‰πêÊí≠ÊîæÂô® -->
        <div class="music-player" v-show="player.currentSong">
            <!-- ÁßªÂä®Á´ØËøõÂ∫¶Êù°ÔºàÂú®Êí≠ÊîæÂô®Â§ñÈÉ®È°∂ÈÉ®Ôºâ -->
            <div class="mobile-progress-box">
                <div class="progress-bar" @click="seekTo($event)">
                    <div class="progress-fill" :style="{ width: progressPercent + '%' }"></div>
                </div>
                <div class="mobile-time-row">
                    <span class="time-text">{{ formatTime(currentTime) }}</span>
                    <span class="time-text">{{ formatTime(duration) }}</span>
                </div>
            </div>

            <div class="player-main">
                <!-- Ê≠åÊõ≤‰ø°ÊÅØ -->
                <div class="song-info">
                    <div class="song-cover-wrapper" @click="togglePlay">
                        <img :src="player.currentSong?.cover_url || '../static/images/notFoundImage.png'" class="song-cover">
                        <div class="cover-overlay" :class="{ 'is-playing': isPlaying }">
                            <i :class="isPlaying ? 'el-icon-video-pause' : 'el-icon-video-play'"></i>
                        </div>
                    </div>
                    <div class="song-text">
                        <div class="song-name">{{ player.currentSong?.title || 'Êú™Êí≠Êîæ' }}</div>
                        <div class="song-artist">{{ player.currentSong?.artist || 'ËØ∑ÈÄâÊã©Ê≠åÊõ≤' }}</div>
                    </div>
                </div>

                <!-- ÊéßÂà∂ÊåâÈíÆ -->
                <div class="control-btns">
                    <button @click="playPrevious" class="ctrl-btn" title="‰∏ä‰∏ÄÈ¶ñ">
                        <i class="el-icon-arrow-left"></i>
                    </button>
                    <!-- Ê°åÈù¢Á´ØÊòæÁ§∫Êí≠ÊîæÊåâÈíÆ -->
                    <button @click="togglePlay" class="ctrl-btn play-btn desktop-only" title="Êí≠Êîæ/ÊöÇÂÅú">
                        <i :class="isPlaying ? 'el-icon-video-pause' : 'el-icon-video-play'"></i>
                    </button>
                    <button @click="playNext" class="ctrl-btn" title="‰∏ã‰∏ÄÈ¶ñ">
                        <i class="el-icon-arrow-right"></i>
                    </button>
                </div>

                <!-- Ê°åÈù¢Á´ØËøõÂ∫¶Êù° -->
                <div class="progress-box desktop-progress">
                    <span class="time-text">{{ formatTime(currentTime) }}</span>
                    <div class="progress-bar" @click="seekTo($event)">
                        <div class="progress-fill" :style="{ width: progressPercent + '%' }"></div>
                    </div>
                    <span class="time-text">{{ formatTime(duration) }}</span>
                </div>

                <!-- Ê≠åËØçÂíåÊí≠ÊîæÂàóË°®ÊåâÈíÆ -->
                <div class="player-actions">
                    <button @click="showLyrics = !showLyrics" class="ctrl-btn lyric-btn" title="Ê≠åËØç" :class="{ active: showLyrics }">
                        <i class="el-icon-document"></i>
                    </button>
                    <button @click="showPlaylist = !showPlaylist" class="ctrl-btn list-btn" title="Êí≠ÊîæÂàóË°®">
                        <i class="el-icon-menu"></i>
                        <span class="list-count" v-if="player.playList.length > 0">{{ player.playList.length }}</span>
                    </button>
                </div>
            </div>

            <!-- Ê≠åËØçÈù¢Êùø -->
            <div class="lyric-panel" v-show="showLyrics">
                <div class="lyric-header">
                    <span>Ê≠åËØç</span>
                    <button @click="showLyrics = false" class="close-btn">
                        <i class="el-icon-close"></i>
                    </button>
                </div>
                <div class="lyric-container">
                    <div v-if="lyrics.length === 0" class="empty-lyric">
                        <i class="el-icon-headset"></i>
                        <p>ÊöÇÊó†Ê≠åËØç</p>
                    </div>
                    <div v-else class="lyric-list">
                        <div v-for="(line, index) in lyrics"
                             :key="index"
                             class="lyric-line"
                             :class="{ active: index === currentLyricIndex }">
                            {{ line.text }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Êí≠ÊîæÂàóË°®Èù¢Êùø -->
            <div class="playlist-panel" v-show="showPlaylist">
                <div class="playlist-header">
                    <span>Êí≠ÊîæÂàóË°® ({{ player.playList.length }})</span>
                    <button @click="showPlaylist = false" class="close-btn">
                        <i class="el-icon-close"></i>
                    </button>
                </div>
                <div class="playlist-body">
                    <div v-for="(song, index) in player.playList" :key="song.id"
                         class="playlist-item"
                         :class="{ active: player.currentSong?.id === song.id }"
                         @click="playMusic(song)">
                        <img :src="song.cover_url" class="item-cover">
                        <div class="item-info">
                            <div class="item-title">{{ song.title }}</div>
                            <div class="item-artist">{{ song.artist }}</div>
                        </div>
                        <button @click.stop="removeFromPlaylist(index)" class="remove-btn">
                            <i class="el-icon-delete"></i>
                        </button>
                    </div>
                    <div v-if="player.playList.length === 0" class="empty-tip">
                        Êí≠ÊîæÂàóË°®‰∏∫Á©∫
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="../static/js/app.js"></script>
</body>

</html>